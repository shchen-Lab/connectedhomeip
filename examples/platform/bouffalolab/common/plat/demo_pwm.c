/**
 * Copyright (c) 2016-2021 Bouffalolab Co., Ltd.
 *
 * Contact information:
 * web site:    https://www.bouffalolab.com/
 */

#include "demo_pwm.h"
#include "board.h"
#include <bl_pwm.h>
#include <stdio.h>
#include <FreeRTOS.h>
#include <task.h>
#include <timers.h>
#include <semphr.h>

#define PWM_FREQ 600
#define PWM_DUTY_CYCLE 10000


static TimerHandle_t Light_TimerHdl=NULL;
volatile static char Light_Timer_Status = 0;
static void demo_hosal_pwm_task_init(void);
static void Light_TimerHandler(TimerHandle_t p_timerhdl);
static void hard_set_color(uint8_t currLevel, uint8_t currHue, uint8_t currSat);
static uint32_t new_Rduty=0;
static uint32_t new_Gduty=0;
static uint32_t new_Bduty=0;
static uint32_t new_Cduty=0;
static uint32_t new_Wduty=0;

static uint32_t Rduty=0;
static uint32_t Gduty=0;
static uint32_t Bduty=0;
static uint32_t Cduty=0;
static uint32_t Wduty=0;

const float pwm_curve[]={0,20.0, 20.011, 20.021, 20.032, 20.042, 20.053, 20.063, 20.074, 20.085, 20.095, 20.106, 20.117, 20.127, 20.138, 20.148, 20.159, 20.17, 20.18, 20.191, 20.202, 20.212, 20.223, 20.234, 20.244, 20.255, 20.266, 20.277, 20.287, 20.298, 20.309, 20.319, 20.33, 20.341, 20.352, 20.362, 20.373, 20.384, 20.395, 20.405, 20.416, 20.427, 20.438, 20.449, 20.459, 20.47, 20.481, 20.492, 20.503, 20.514, 20.524, 20.535, 20.546, 20.557, 20.568, 20.579, 20.59, 20.6, 20.611, 20.622, 20.633, 20.644, 20.655, 20.666, 20.677, 20.688, 20.699, 20.71, 20.72, 20.731, 20.742, 20.753, 20.764, 20.775, 20.786, 20.797, 20.808, 20.819, 20.83, 20.841, 20.852, 20.863, 20.874, 20.885, 20.896, 20.907, 20.918, 20.929, 20.941, 20.952, 20.963, 20.974, 20.985, 20.996, 21.007, 21.018, 21.029, 21.04, 21.051, 21.063, 21.074, 21.085, 21.096, 21.107, 21.118, 21.129, 21.141, 21.152, 21.163, 21.174, 21.185, 21.196, 21.208, 21.219, 21.23, 21.241, 21.253, 21.264, 21.275, 21.286, 21.297, 21.309, 21.32, 21.331, 21.343, 21.354, 21.365, 21.376, 21.388, 21.399, 21.41, 21.422, 21.433, 21.444, 21.456, 21.467, 21.478, 21.49, 21.501, 21.512, 21.524, 21.535, 21.546, 21.558, 21.569, 21.581, 21.592, 21.603, 21.615, 21.626, 21.638, 21.649, 21.661, 21.672, 21.683, 21.695, 21.706, 21.718, 21.729, 21.741, 21.752, 21.764, 21.775, 21.787, 21.798, 21.81, 21.821, 21.833, 21.844, 21.856, 21.867, 21.879, 21.891, 21.902, 21.914, 21.925, 21.937, 21.948, 21.96, 21.972, 21.983, 21.995, 22.006, 22.018, 22.03, 22.041, 22.053, 22.065, 22.076, 22.088, 22.1, 22.111, 22.123, 22.135, 22.146, 22.158, 22.17, 22.182, 22.193, 22.205, 22.217, 22.228, 22.24, 22.252, 22.264, 22.275, 22.287, 22.299, 22.311, 22.323, 22.334, 22.346, 22.358, 22.37, 22.382, 22.393, 22.405, 22.417, 22.429, 22.441, 22.453, 22.465, 22.476, 22.488, 22.5, 22.512, 22.524, 22.536, 22.548, 22.56, 22.572, 22.583, 22.595, 22.607, 22.619, 22.631, 22.643, 22.655, 22.667, 22.679, 22.691, 22.703, 22.715, 22.727, 22.739, 22.751, 22.763, 22.775, 22.787, 22.799, 22.811, 22.823, 22.835, 22.847, 22.86, 22.872, 22.884, 22.896, 22.908, 22.92, 22.932, 22.944, 22.956, 22.968, 22.981, 22.993, 23.005, 23.017, 23.029, 23.041, 23.054, 23.066, 23.078, 23.09, 23.102, 23.115, 23.127, 23.139, 23.151, 23.163, 23.176, 23.188, 23.2, 23.212, 23.225, 23.237, 23.249, 23.261, 23.274, 23.286, 23.298, 23.311, 23.323, 23.335, 23.348, 23.36, 23.372, 23.385, 23.397, 23.409, 23.422, 23.434, 23.447, 23.459, 23.471, 23.484, 23.496, 23.509, 23.521, 23.533, 23.546, 23.558, 23.571, 23.583, 23.596, 23.608, 23.621, 23.633, 23.646, 23.658, 23.67, 23.683, 23.696, 23.708, 23.721, 23.733, 23.746, 23.758, 23.771, 23.783, 23.796, 23.808, 23.821, 23.834, 23.846, 23.859, 23.871, 23.884, 23.897, 23.909, 23.922, 23.935, 23.947, 23.96, 23.972, 23.985, 23.998, 24.01, 24.023, 24.036, 24.049, 24.061, 24.074, 24.087, 24.099, 24.112, 24.125, 24.138, 24.15, 24.163, 24.176, 24.189, 24.201, 24.214, 24.227, 24.24, 24.253, 24.265, 24.278, 24.291, 24.304, 24.317, 24.33, 24.343, 24.355, 24.368, 24.381, 24.394, 24.407, 24.42, 24.433, 24.446, 24.459, 24.471, 24.484, 24.497, 24.51, 24.523, 24.536, 24.549, 24.562, 24.575, 24.588, 24.601, 24.614, 24.627, 24.64, 24.653, 24.666, 24.679, 24.692, 24.705, 24.718, 24.731, 24.744, 24.757, 24.771, 24.784, 24.797, 24.81, 24.823, 24.836, 24.849, 24.862, 24.875, 24.889, 24.902, 24.915, 24.928, 24.941, 24.954, 24.968, 24.981, 24.994, 25.007, 25.02, 25.034, 25.047, 25.06, 25.073, 25.087, 25.1, 25.113, 25.126, 25.14, 25.153, 25.166, 25.179, 25.193, 25.206, 25.219, 25.233, 25.246, 25.259, 25.273, 25.286, 25.299, 25.313, 25.326, 25.34, 25.353, 25.366, 25.38, 25.393, 25.407, 25.42, 25.433, 25.447, 25.46, 25.474, 25.487, 25.501, 25.514, 25.528, 25.541, 25.555, 25.568, 25.582, 25.595, 25.609, 25.622, 25.636, 25.649, 25.663, 25.676, 25.69, 25.704, 25.717, 25.731, 25.744, 25.758, 25.772, 25.785, 25.799, 25.812, 25.826, 25.84, 25.853, 25.867, 25.881, 25.894, 25.908, 25.922, 25.935, 25.949, 25.963, 25.977, 25.99, 26.004, 26.018, 26.031, 26.045, 26.059, 26.073, 26.087, 26.1, 26.114, 26.128, 26.142, 26.156, 26.169, 26.183, 26.197, 26.211, 26.225, 26.239, 26.252, 26.266, 26.28, 26.294, 26.308, 26.322, 26.336, 26.35, 26.364, 26.377, 26.391, 26.405, 26.419, 26.433, 26.447, 26.461, 26.475, 26.489, 26.503, 26.517, 26.531, 26.545, 26.559, 26.573, 26.587, 26.601, 26.615, 26.629, 26.644, 26.658, 26.672, 26.686, 26.7, 26.714, 26.728, 26.742, 26.756, 26.771, 26.785, 26.799, 26.813, 26.827, 26.841, 26.855, 26.87, 26.884, 26.898, 26.912, 26.927, 26.941, 26.955, 26.969, 26.983, 26.998, 27.012, 27.026, 27.041, 27.055, 27.069, 27.083, 27.098, 27.112, 27.126, 27.141, 27.155, 27.169, 27.184, 27.198, 27.212, 27.227, 27.241, 27.256, 27.27, 27.284, 27.299, 27.313, 27.328, 27.342, 27.357, 27.371, 27.386, 27.4, 27.414, 27.429, 27.443, 27.458, 27.472, 27.487, 27.501, 27.516, 27.531, 27.545, 27.56, 27.574, 27.589, 27.603, 27.618, 27.633, 27.647, 27.662, 27.676, 27.691, 27.706, 27.72, 27.735, 27.75, 27.764, 27.779, 27.794, 27.808, 27.823, 27.838, 27.852, 27.867, 27.882, 27.896, 27.911, 27.926, 27.941, 27.955, 27.97, 27.985, 28.0, 28.015, 28.029, 28.044, 28.059, 28.074, 28.089, 28.104, 28.118, 28.133, 28.148, 28.163, 28.178, 28.193, 28.208, 28.223, 28.237, 28.252, 28.267, 28.282, 28.297, 28.312, 28.327, 28.342, 28.357, 28.372, 28.387, 28.402, 28.417, 28.432, 28.447, 28.462, 28.477, 28.492, 28.507, 28.522, 28.537, 28.552, 28.568, 28.583, 28.598, 28.613, 28.628, 28.643, 28.658, 28.673, 28.688, 28.704, 28.719, 28.734, 28.749, 28.764, 28.78, 28.795, 28.81, 28.825, 28.84, 28.856, 28.871, 28.886, 28.901, 28.917, 28.932, 28.947, 28.963, 28.978, 28.993, 29.008, 29.024, 29.039, 29.054, 29.07, 29.085, 29.101, 29.116, 29.131, 29.147, 29.162, 29.178, 29.193, 29.208, 29.224, 29.239, 29.255, 29.27, 29.286, 29.301, 29.317, 29.332, 29.348, 29.363, 29.379, 29.394, 29.41, 29.425, 29.441, 29.456, 29.472, 29.487, 29.503, 29.519, 29.534, 29.55, 29.565, 29.581, 29.597, 29.612, 29.628, 29.644, 29.659, 29.675, 29.691, 29.706, 29.722, 29.738, 29.753, 29.769, 29.785, 29.801, 29.816, 29.832, 29.848, 29.864, 29.879, 29.895, 29.911, 29.927, 29.943, 29.958, 29.974, 29.99, 30.006, 30.022, 30.038, 30.053, 30.069, 30.085, 30.101, 30.117, 30.133, 30.149, 30.165, 30.181, 30.197, 30.213, 30.229, 30.245, 30.261, 30.277, 30.293, 30.309, 30.325, 30.341, 30.357, 30.373, 30.389, 30.405, 30.421, 30.437, 30.453, 30.469, 30.485, 30.501, 30.517, 30.533, 30.55, 30.566, 30.582, 30.598, 30.614, 30.63, 30.647, 30.663, 30.679, 30.695, 30.711, 30.728, 30.744, 30.76, 30.776, 30.793, 30.809, 30.825, 30.841, 30.858, 30.874, 30.89, 30.907, 30.923, 30.939, 30.956, 30.972, 30.988, 31.005, 31.021, 31.038, 31.054, 31.07, 31.087, 31.103, 31.12, 31.136, 31.153, 31.169, 31.185, 31.202, 31.218, 31.235, 31.251, 31.268, 31.284, 31.301, 31.318, 31.334, 31.351, 31.367, 31.384, 31.4, 31.417, 31.434, 31.45, 31.467, 31.483, 31.5, 31.517, 31.533, 31.55, 31.567, 31.583, 31.6, 31.617, 31.633, 31.65, 31.667, 31.684, 31.7, 31.717, 31.734, 31.751, 31.767, 31.784, 31.801, 31.818, 31.835, 31.851, 31.868, 31.885, 31.902, 31.919, 31.936, 31.952, 31.969, 31.986, 32.003, 32.02, 32.037, 32.054, 32.071, 32.088, 32.105, 32.122, 32.139, 32.156, 32.173, 32.19, 32.207, 32.224, 32.241, 32.258, 32.275, 32.292, 32.309, 32.326, 32.343, 32.36, 32.377, 32.394, 32.411, 32.429, 32.446, 32.463, 32.48, 32.497, 32.514, 32.531, 32.549, 32.566, 32.583, 32.6, 32.618, 32.635, 32.652, 32.669, 32.686, 32.704, 32.721, 32.738, 32.756, 32.773, 32.79, 32.808, 32.825, 32.842, 32.86, 32.877, 32.894, 32.912, 32.929, 32.947, 32.964, 32.981, 32.999, 33.016, 33.034, 33.051, 33.069, 33.086, 33.103, 33.121, 33.138, 33.156, 33.174, 33.191, 33.209, 33.226, 33.244, 33.261, 33.279, 33.296, 33.314, 33.332, 33.349, 33.367, 33.384, 33.402, 33.42, 33.437, 33.455, 33.473, 33.49, 33.508, 33.526, 33.544, 33.561, 33.579, 33.597, 33.614, 33.632, 33.65, 33.668, 33.686, 33.703, 33.721, 33.739, 33.757, 33.775, 33.793, 33.81, 33.828, 33.846, 33.864, 33.882, 33.9, 33.918, 33.936, 33.954, 33.971, 33.989, 34.007, 34.025, 34.043, 34.061, 34.079, 34.097, 34.115, 34.133, 34.151, 34.169, 34.187, 34.206, 34.224, 34.242, 34.26, 34.278, 34.296, 34.314, 34.332, 34.35, 34.369, 34.387, 34.405, 34.423, 34.441, 34.459, 34.478, 34.496, 34.514, 34.532, 34.551, 34.569, 34.587, 34.605, 34.624, 34.642, 34.66, 34.679, 34.697, 34.715, 34.734, 34.752, 34.77, 34.789, 34.807, 34.825, 34.844, 34.862, 34.881, 34.899, 34.917, 34.936, 34.954, 34.973, 34.991, 35.01, 35.028, 35.047, 35.065, 35.084, 35.102, 35.121, 35.14, 35.158, 35.177, 35.195, 35.214, 35.232, 35.251, 35.27, 35.288, 35.307, 35.326, 35.344, 35.363, 35.382, 35.4, 35.419, 35.438, 35.456, 35.475, 35.494, 35.513, 35.531, 35.55, 35.569, 35.588, 35.607, 35.625, 35.644, 35.663, 35.682, 35.701, 35.72, 35.739, 35.757, 35.776, 35.795, 35.814, 35.833, 35.852, 35.871, 35.89, 35.909, 35.928, 35.947, 35.966, 35.985, 36.004, 36.023, 36.042, 36.061, 36.08, 36.099, 36.118, 36.137, 36.156, 36.175, 36.194, 36.214, 36.233, 36.252, 36.271, 36.29, 36.309, 36.329, 36.348, 36.367, 36.386, 36.405, 36.425, 36.444, 36.463, 36.482, 36.502, 36.521, 36.54, 36.56, 36.579, 36.598, 36.617, 36.637, 36.656, 36.676, 36.695, 36.714, 36.734, 36.753, 36.773, 36.792, 36.811, 36.831, 36.85, 36.87, 36.889, 36.909, 36.928, 36.948, 36.967, 36.987, 37.006, 37.026, 37.045, 37.065, 37.085, 37.104, 37.124, 37.143, 37.163, 37.183, 37.202, 37.222, 37.242, 37.261, 37.281, 37.301, 37.32, 37.34, 37.36, 37.38, 37.399, 37.419, 37.439, 37.459, 37.478, 37.498, 37.518, 37.538, 37.558, 37.578, 37.597, 37.617, 37.637, 37.657, 37.677, 37.697, 37.717, 37.737, 37.757, 37.777, 37.797, 37.817, 37.837, 37.857, 37.877, 37.897, 37.917, 37.937, 37.957, 37.977, 37.997, 38.017, 38.037, 38.057, 38.077, 38.097, 38.117, 38.137, 38.158, 38.178, 38.198, 38.218, 38.238, 38.259, 38.279, 38.299, 38.319, 38.339, 38.36, 38.38, 38.4, 38.421, 38.441, 38.461, 38.481, 38.502, 38.522, 38.543, 38.563, 38.583, 38.604, 38.624, 38.644, 38.665, 38.685, 38.706, 38.726, 38.747, 38.767, 38.788, 38.808, 38.829, 38.849, 38.87, 38.89, 38.911, 38.931, 38.952, 38.972, 38.993, 39.014, 39.034, 39.055, 39.075, 39.096, 39.117, 39.137, 39.158, 39.179, 39.2, 39.22, 39.241, 39.262, 39.282, 39.303, 39.324, 39.345, 39.366, 39.386, 39.407, 39.428, 39.449, 39.47, 39.49, 39.511, 39.532, 39.553, 39.574, 39.595, 39.616, 39.637, 39.658, 39.679, 39.7, 39.721, 39.742, 39.763, 39.784, 39.805, 39.826, 39.847, 39.868, 39.889, 39.91, 39.931, 39.952, 39.973, 39.994, 40.015, 40.037, 40.058, 40.079, 40.1, 40.121, 40.142, 40.164, 40.185, 40.206, 40.227, 40.249, 40.27, 40.291, 40.312, 40.334, 40.355, 40.376, 40.398, 40.419, 40.44, 40.462, 40.483, 40.504, 40.526, 40.547, 40.569, 40.59, 40.612, 40.633, 40.655, 40.676, 40.698, 40.719, 40.741, 40.762, 40.784, 40.805, 40.827, 40.848, 40.87, 40.891, 40.913, 40.935, 40.956, 40.978, 41.0, 41.021, 41.043, 41.065, 41.086, 41.108, 41.13, 41.151, 41.173, 41.195, 41.217, 41.238, 41.26, 41.282, 41.304, 41.326, 41.348, 41.369, 41.391, 41.413, 41.435, 41.457, 41.479, 41.501, 41.523, 41.545, 41.567, 41.588, 41.61, 41.632, 41.654, 41.676, 41.698, 41.72, 41.743, 41.765, 41.787, 41.809, 41.831, 41.853, 41.875, 41.897, 41.919, 41.941, 41.964, 41.986, 42.008, 42.03, 42.052, 42.075, 42.097, 42.119, 42.141, 42.164, 42.186, 42.208, 42.23, 42.253, 42.275, 42.297, 42.32, 42.342, 42.364, 42.387, 42.409, 42.432, 42.454, 42.477, 42.499, 42.521, 42.544, 42.566, 42.589, 42.611, 42.634, 42.656, 42.679, 42.701, 42.724, 42.747, 42.769, 42.792, 42.814, 42.837, 42.86, 42.882, 42.905, 42.928, 42.95, 42.973, 42.996, 43.018, 43.041, 43.064, 43.087, 43.109, 43.132, 43.155, 43.178, 43.201, 43.223, 43.246, 43.269, 43.292, 43.315, 43.338, 43.361, 43.384, 43.406, 43.429, 43.452, 43.475, 43.498, 43.521, 43.544, 43.567, 43.59, 43.613, 43.636, 43.659, 43.682, 43.706, 43.729, 43.752, 43.775, 43.798, 43.821, 43.844, 43.867, 43.891, 43.914, 43.937, 43.96, 43.983, 44.007, 44.03, 44.053, 44.076, 44.1, 44.123, 44.146, 44.17, 44.193, 44.216, 44.24, 44.263, 44.286, 44.31, 44.333, 44.357, 44.38, 44.404, 44.427, 44.451, 44.474, 44.498, 44.521, 44.545, 44.568, 44.592, 44.615, 44.639, 44.662, 44.686, 44.71, 44.733, 44.757, 44.78, 44.804, 44.828, 44.851, 44.875, 44.899, 44.923, 44.946, 44.97, 44.994, 45.018, 45.041, 45.065, 45.089, 45.113, 45.137, 45.161, 45.184, 45.208, 45.232, 45.256, 45.28, 45.304, 45.328, 45.352, 45.376, 45.4, 45.424, 45.448, 45.472, 45.496, 45.52, 45.544, 45.568, 45.592, 45.616, 45.64, 45.664, 45.688, 45.712, 45.737, 45.761, 45.785, 45.809, 45.833, 45.858, 45.882, 45.906, 45.93, 45.955, 45.979, 46.003, 46.027, 46.052, 46.076, 46.1, 46.125, 46.149, 46.174, 46.198, 46.222, 46.247, 46.271, 46.296, 46.32, 46.345, 46.369, 46.394, 46.418, 46.443, 46.467, 46.492, 46.516, 46.541, 46.565, 46.59, 46.615, 46.639, 46.664, 46.689, 46.713, 46.738, 46.763, 46.787, 46.812, 46.837, 46.862, 46.886, 46.911, 46.936, 46.961, 46.985, 47.01, 47.035, 47.06, 47.085, 47.11, 47.135, 47.16, 47.184, 47.209, 47.234, 47.259, 47.284, 47.309, 47.334, 47.359, 47.384, 47.409, 47.434, 47.459, 47.484, 47.51, 47.535, 47.56, 47.585, 47.61, 47.635, 47.66, 47.686, 47.711, 47.736, 47.761, 47.786, 47.812, 47.837, 47.862, 47.887, 47.913, 47.938, 47.963, 47.989, 48.014, 48.039, 48.065, 48.09, 48.116, 48.141, 48.167, 48.192, 48.217, 48.243, 48.268, 48.294, 48.319, 48.345, 48.37, 48.396, 48.422, 48.447, 48.473, 48.498, 48.524, 48.55, 48.575, 48.601, 48.627, 48.652, 48.678, 48.704, 48.729, 48.755, 48.781, 48.807, 48.833, 48.858, 48.884, 48.91, 48.936, 48.962, 48.988, 49.013, 49.039, 49.065, 49.091, 49.117, 49.143, 49.169, 49.195, 49.221, 49.247, 49.273, 49.299, 49.325, 49.351, 49.377, 49.403, 49.429, 49.456, 49.482, 49.508, 49.534, 49.56, 49.586, 49.613, 49.639, 49.665, 49.691, 49.717, 49.744, 49.77, 49.796, 49.823, 49.849, 49.875, 49.902, 49.928, 49.954, 49.981, 50.007, 50.034, 50.06, 50.086, 50.113, 50.139, 50.166, 50.192, 50.219, 50.245, 50.272, 50.299, 50.325, 50.352, 50.378, 50.405, 50.432, 50.458, 50.485, 50.512, 50.538, 50.565, 50.592, 50.618, 50.645, 50.672, 50.699, 50.725, 50.752, 50.779, 50.806, 50.833, 50.86, 50.886, 50.913, 50.94, 50.967, 50.994, 51.021, 51.048, 51.075, 51.102, 51.129, 51.156, 51.183, 51.21, 51.237, 51.264, 51.291, 51.318, 51.345, 51.373, 51.4, 51.427, 51.454, 51.481, 51.508, 51.536, 51.563, 51.59, 51.617, 51.645, 51.672, 51.699, 51.727, 51.754, 51.781, 51.809, 51.836, 51.863, 51.891, 51.918, 51.946, 51.973, 52.001, 52.028, 52.055, 52.083, 52.11, 52.138, 52.166, 52.193, 52.221, 52.248, 52.276, 52.304, 52.331, 52.359, 52.386, 52.414, 52.442, 52.47, 52.497, 52.525, 52.553, 52.581, 52.608, 52.636, 52.664, 52.692, 52.72, 52.747, 52.775, 52.803, 52.831, 52.859, 52.887, 52.915, 52.943, 52.971, 52.999, 53.027, 53.055, 53.083, 53.111, 53.139, 53.167, 53.195, 53.223, 53.251, 53.279, 53.308, 53.336, 53.364, 53.392, 53.42, 53.449, 53.477, 53.505, 53.533, 53.562, 53.59, 53.618, 53.647, 53.675, 53.703, 53.732, 53.76, 53.788, 53.817, 53.845, 53.874, 53.902, 53.931, 53.959, 53.988, 54.016, 54.045, 54.073, 54.102, 54.13, 54.159, 54.188, 54.216, 54.245, 54.274, 54.302, 54.331, 54.36, 54.388, 54.417, 54.446, 54.475, 54.503, 54.532, 54.561, 54.59, 54.619, 54.648, 54.676, 54.705, 54.734, 54.763, 54.792, 54.821, 54.85, 54.879, 54.908, 54.937, 54.966, 54.995, 55.024, 55.053, 55.082, 55.111, 55.14, 55.17, 55.199, 55.228, 55.257, 55.286, 55.316, 55.345, 55.374, 55.403, 55.433, 55.462, 55.491, 55.52, 55.55, 55.579, 55.608, 55.638, 55.667, 55.697, 55.726, 55.756, 55.785, 55.814, 55.844, 55.873, 55.903, 55.933, 55.962, 55.992, 56.021, 56.051, 56.08, 56.11, 56.14, 56.169, 56.199, 56.229, 56.258, 56.288, 56.318, 56.348, 56.377, 56.407, 56.437, 56.467, 56.497, 56.527, 56.556, 56.586, 56.616, 56.646, 56.676, 56.706, 56.736, 56.766, 56.796, 56.826, 56.856, 56.886, 56.916, 56.946, 56.976, 57.006, 57.036, 57.067, 57.097, 57.127, 57.157, 57.187, 57.217, 57.248, 57.278, 57.308, 57.338, 57.369, 57.399, 57.429, 57.46, 57.49, 57.52, 57.551, 57.581, 57.612, 57.642, 57.673, 57.703, 57.734, 57.764, 57.795, 57.825, 57.856, 57.886, 57.917, 57.947, 57.978, 58.009, 58.039, 58.07, 58.101, 58.131, 58.162, 58.193, 58.224, 58.254, 58.285, 58.316, 58.347, 58.377, 58.408, 58.439, 58.47, 58.501, 58.532, 58.563, 58.594, 58.625, 58.656, 58.687, 58.718, 58.749, 58.78, 58.811, 58.842, 58.873, 58.904, 58.935, 58.966, 58.997, 59.029, 59.06, 59.091, 59.122, 59.153, 59.185, 59.216, 59.247, 59.279, 59.31, 59.341, 59.373, 59.404, 59.435, 59.467, 59.498, 59.53, 59.561, 59.593, 59.624, 59.656, 59.687, 59.719, 59.75, 59.782, 59.813, 59.845, 59.876, 59.908, 59.94, 59.971, 60.003, 60.035, 60.067, 60.098, 60.13, 60.162, 60.194, 60.225, 60.257, 60.289, 60.321, 60.353, 60.385, 60.417, 60.448, 60.48, 60.512, 60.544, 60.576, 60.608, 60.64, 60.672, 60.704, 60.737, 60.769, 60.801, 60.833, 60.865, 60.897, 60.929, 60.962, 60.994, 61.026, 61.058, 61.09, 61.123, 61.155, 61.187, 61.22, 61.252, 61.284, 61.317, 61.349, 61.382, 61.414, 61.446, 61.479, 61.511, 61.544, 61.576, 61.609, 61.641, 61.674, 61.707, 61.739, 61.772, 61.805, 61.837, 61.87, 61.903, 61.935, 61.968, 62.001, 62.033, 62.066, 62.099, 62.132, 62.165, 62.197, 62.23, 62.263, 62.296, 62.329, 62.362, 62.395, 62.428, 62.461, 62.494, 62.527, 62.56, 62.593, 62.626, 62.659, 62.692, 62.725, 62.759, 62.792, 62.825, 62.858, 62.891, 62.924, 62.958, 62.991, 63.024, 63.058, 63.091, 63.124, 63.158, 63.191, 63.224, 63.258, 63.291, 63.325, 63.358, 63.392, 63.425, 63.459, 63.492, 63.526, 63.559, 63.593, 63.626, 63.66, 63.694, 63.727, 63.761, 63.795, 63.828, 63.862, 63.896, 63.93, 63.963, 63.997, 64.031, 64.065, 64.099, 64.132, 64.166, 64.2, 64.234, 64.268, 64.302, 64.336, 64.37, 64.404, 64.438, 64.472, 64.506, 64.54, 64.574, 64.608, 64.643, 64.677, 64.711, 64.745, 64.779, 64.814, 64.848, 64.882, 64.916, 64.951, 64.985, 65.019, 65.054, 65.088, 65.122, 65.157, 65.191, 65.226, 65.26, 65.295, 65.329, 65.364, 65.398, 65.433, 65.467, 65.502, 65.536, 65.571, 65.606, 65.64, 65.675, 65.71, 65.745, 65.779, 65.814, 65.849, 65.884, 65.918, 65.953, 65.988, 66.023, 66.058, 66.093, 66.128, 66.163, 66.198, 66.232, 66.267, 66.302, 66.338, 66.373, 66.408, 66.443, 66.478, 66.513, 66.548, 66.583, 66.618, 66.654, 66.689, 66.724, 66.759, 66.795, 66.83, 66.865, 66.901, 66.936, 66.971, 67.007, 67.042, 67.077, 67.113, 67.148, 67.184, 67.219, 67.255, 67.29, 67.326, 67.361, 67.397, 67.433, 67.468, 67.504, 67.54, 67.575, 67.611, 67.647, 67.682, 67.718, 67.754, 67.79, 67.826, 67.861, 67.897, 67.933, 67.969, 68.005, 68.041, 68.077, 68.113, 68.149, 68.185, 68.221, 68.257, 68.293, 68.329, 68.365, 68.401, 68.437, 68.474, 68.51, 68.546, 68.582, 68.618, 68.655, 68.691, 68.727, 68.764, 68.8, 68.836, 68.873, 68.909, 68.945, 68.982, 69.018, 69.055, 69.091, 69.128, 69.164, 69.201, 69.237, 69.274, 69.311, 69.347, 69.384, 69.42, 69.457, 69.494, 69.531, 69.567, 69.604, 69.641, 69.678, 69.714, 69.751, 69.788, 69.825, 69.862, 69.899, 69.936, 69.973, 70.01, 70.047, 70.084, 70.121, 70.158, 70.195, 70.232, 70.269, 70.306, 70.343, 70.38, 70.418, 70.455, 70.492, 70.529, 70.566, 70.604, 70.641, 70.678, 70.716, 70.753, 70.79, 70.828, 70.865, 70.903, 70.94, 70.978, 71.015, 71.053, 71.09, 71.128, 71.165, 71.203, 71.241, 71.278, 71.316, 71.354, 71.391, 71.429, 71.467, 71.505, 71.542, 71.58, 71.618, 71.656, 71.694, 71.731, 71.769, 71.807, 71.845, 71.883, 71.921, 71.959, 71.997, 72.035, 72.073, 72.111, 72.149, 72.188, 72.226, 72.264, 72.302, 72.34, 72.378, 72.417, 72.455, 72.493, 72.532, 72.57, 72.608, 72.647, 72.685, 72.723, 72.762, 72.8, 72.839, 72.877, 72.916, 72.954, 72.993, 73.031, 73.07, 73.109, 73.147, 73.186, 73.224, 73.263, 73.302, 73.341, 73.379, 73.418, 73.457, 73.496, 73.535, 73.573, 73.612, 73.651, 73.69, 73.729, 73.768, 73.807, 73.846, 73.885, 73.924, 73.963, 74.002, 74.041, 74.08, 74.119, 74.159, 74.198, 74.237, 74.276, 74.315, 74.355, 74.394, 74.433, 74.473, 74.512, 74.551, 74.591, 74.63, 74.67, 74.709, 74.749, 74.788, 74.828, 74.867, 74.907, 74.946, 74.986, 75.025, 75.065, 75.105, 75.144, 75.184, 75.224, 75.264, 75.303, 75.343, 75.383, 75.423, 75.463, 75.502, 75.542, 75.582, 75.622, 75.662, 75.702, 75.742, 75.782, 75.822, 75.862, 75.902, 75.942, 75.983, 76.023, 76.063, 76.103, 76.143, 76.184, 76.224, 76.264, 76.304, 76.345, 76.385, 76.425, 76.466, 76.506, 76.547, 76.587, 76.627, 76.668, 76.708, 76.749, 76.79, 76.83, 76.871, 76.911, 76.952, 76.993, 77.033, 77.074, 77.115, 77.155, 77.196, 77.237, 77.278, 77.319, 77.359, 77.4, 77.441, 77.482, 77.523, 77.564, 77.605, 77.646, 77.687, 77.728, 77.769, 77.81, 77.851, 77.892, 77.934, 77.975, 78.016, 78.057, 78.098, 78.14, 78.181, 78.222, 78.264, 78.305, 78.346, 78.388, 78.429, 78.471, 78.512, 78.554, 78.595, 78.637, 78.678, 78.72, 78.761, 78.803, 78.845, 78.886, 78.928, 78.97, 79.011, 79.053, 79.095, 79.137, 79.178, 79.22, 79.262, 79.304, 79.346, 79.388, 79.43, 79.472, 79.514, 79.556, 79.598, 79.64, 79.682, 79.724, 79.766, 79.808, 79.85, 79.893, 79.935, 79.977, 80.019, 80.062, 80.104, 80.146, 80.189, 80.231, 80.273, 80.316, 80.358, 80.401, 80.443, 80.486, 80.528, 80.571, 80.613, 80.656, 80.698, 80.741, 80.784, 80.826, 80.869, 80.912, 80.955, 80.997, 81.04, 81.083, 81.126, 81.169, 81.212, 81.254, 81.297, 81.34, 81.383, 81.426, 81.469, 81.512, 81.555, 81.599, 81.642, 81.685, 81.728, 81.771, 81.814, 81.858, 81.901, 81.944, 81.987, 82.031, 82.074, 82.117, 82.161, 82.204, 82.248, 82.291, 82.335, 82.378, 82.422, 82.465, 82.509, 82.552, 82.596, 82.64, 82.683, 82.727, 82.771, 82.814, 82.858, 82.902, 82.946, 82.99, 83.033, 83.077, 83.121, 83.165, 83.209, 83.253, 83.297, 83.341, 83.385, 83.429, 83.473, 83.517, 83.561, 83.605, 83.65, 83.694, 83.738, 83.782, 83.827, 83.871, 83.915, 83.96, 84.004, 84.048, 84.093, 84.137, 84.182, 84.226, 84.271, 84.315, 84.36, 84.404, 84.449, 84.493, 84.538, 84.583, 84.627, 84.672, 84.717, 84.762, 84.806, 84.851, 84.896, 84.941, 84.986, 85.031, 85.076, 85.121, 85.165, 85.21, 85.255, 85.301, 85.346, 85.391, 85.436, 85.481, 85.526, 85.571, 85.617, 85.662, 85.707, 85.752, 85.798, 85.843, 85.888, 85.934, 85.979, 86.024, 86.07, 86.115, 86.161, 86.206, 86.252, 86.298, 86.343, 86.389, 86.434, 86.48, 86.526, 86.571, 86.617, 86.663, 86.709, 86.755, 86.8, 86.846, 86.892, 86.938, 86.984, 87.03, 87.076, 87.122, 87.168, 87.214, 87.26, 87.306, 87.352, 87.399, 87.445, 87.491, 87.537, 87.583, 87.63, 87.676, 87.722, 87.769, 87.815, 87.861, 87.908, 87.954, 88.001, 88.047, 88.094, 88.14, 88.187, 88.233, 88.28, 88.327, 88.373, 88.42, 88.467, 88.513, 88.56, 88.607, 88.654, 88.701, 88.748, 88.794, 88.841, 88.888, 88.935, 88.982, 89.029, 89.076, 89.123, 89.17, 89.218, 89.265, 89.312, 89.359, 89.406, 89.454, 89.501, 89.548, 89.595, 89.643, 89.69, 89.737, 89.785, 89.832, 89.88, 89.927, 89.975, 90.022, 90.07, 90.117, 90.165, 90.213, 90.26, 90.308, 90.356, 90.404, 90.451, 90.499, 90.547, 90.595, 90.643, 90.69, 90.738, 90.786, 90.834, 90.882, 90.93, 90.978, 91.026, 91.075, 91.123, 91.171, 91.219, 91.267, 91.315, 91.364, 91.412, 91.46, 91.509, 91.557, 91.605, 91.654, 91.702, 91.75, 91.799, 91.847, 91.896, 91.945, 91.993, 92.042, 92.09, 92.139, 92.188, 92.236, 92.285, 92.334, 92.383, 92.431, 92.48, 92.529, 92.578, 92.627, 92.676, 92.725, 92.774, 92.823, 92.872, 92.921, 92.97, 93.019, 93.068, 93.118, 93.167, 93.216, 93.265, 93.314, 93.364, 93.413, 93.462, 93.512, 93.561, 93.611, 93.66, 93.71, 93.759, 93.809, 93.858, 93.908, 93.957, 94.007, 94.057, 94.106, 94.156, 94.206, 94.256, 94.306, 94.355, 94.405, 94.455, 94.505, 94.555, 94.605, 94.655, 94.705, 94.755, 94.805, 94.855, 94.905, 94.955, 95.005, 95.056, 95.106, 95.156, 95.206, 95.257, 95.307, 95.357, 95.408, 95.458, 95.509, 95.559, 95.61, 95.66, 95.711, 95.761, 95.812, 95.862, 95.913, 95.964, 96.014, 96.065, 96.116, 96.167, 96.218, 96.268, 96.319, 96.37, 96.421, 96.472, 96.523, 96.574, 96.625, 96.676, 96.727, 96.778, 96.829, 96.88, 96.932, 96.983, 97.034, 97.085, 97.137, 97.188, 97.239, 97.291, 97.342, 97.394, 97.445, 97.496, 97.548, 97.6, 97.651, 97.703, 97.754, 97.806, 97.858, 97.909, 97.961, 98.013, 98.065, 98.116, 98.168, 98.22, 98.272, 98.324, 98.376, 98.428, 98.48, 98.532, 98.584, 98.636, 98.688, 98.74, 98.792, 98.845, 98.897, 98.949, 99.001, 99.054, 99.106, 99.158, 99.211, 99.263, 99.316, 99.368, 99.421, 99.473, 99.526, 99.578, 99.631, 99.684, 99.736, 99.789, 99.842, 99.894, 99.947, 100.0};


void demo_hosal_pwm_init(void)
{
    
    bl_pwm_port_init(LED_R_PIN_PORT, PWM_FREQ);
    bl_pwm_port_init(LED_B_PIN_PORT, PWM_FREQ);
    bl_pwm_port_init(LED_G_PIN_PORT, PWM_FREQ);
    bl_pwm_port_init(LED_C_PIN_PORT, PWM_FREQ);
    bl_pwm_port_init(LED_W_PIN_PORT, PWM_FREQ);

    bl_pwm_channel_init(LED_R_PIN_PORT, LED_R_PIN);
    bl_pwm_channel_init(LED_B_PIN_PORT, LED_B_PIN);
    bl_pwm_channel_init(LED_G_PIN_PORT, LED_G_PIN);
    bl_pwm_channel_init(LED_C_PIN_PORT, LED_C_PIN);
    bl_pwm_channel_init(LED_W_PIN_PORT, LED_W_PIN);
    demo_hosal_pwm_task_init();
}

void demo_hosal_pwm_start(void)
{
    /* start pwm */
    for (uint32_t i = 0; i < MAX_PWM_CHANNEL; i++)
    {
        bl_pwm_start(i);
    }
}

void demo_hosal_pwm_set_param(uint32_t p_Rduty,uint32_t p_Gduty,uint32_t p_Bduty,uint32_t p_Cduty,uint32_t p_Wduty)
{

    uint16_t threshold1, threshold2;
    threshold1 = 0;

    bl_pwm_set_duty(LED_R_PIN_PORT, pwm_curve[p_Rduty]);
    bl_pwm_set_duty(LED_G_PIN_PORT, pwm_curve[p_Gduty]);
    bl_pwm_set_duty(LED_B_PIN_PORT, pwm_curve[p_Bduty]);
    if((pwm_curve[p_Cduty]+pwm_curve[p_Wduty])>100)
    {
        printf("%s >100",__func__);
    }
    else
    {
        bl_pwm_set_duty_ex(LED_C_PIN_PORT, pwm_curve[p_Cduty],&threshold1, &threshold2);
        threshold1 = threshold2;
        bl_pwm_set_duty_ex(LED_W_PIN_PORT, pwm_curve[p_Wduty],&threshold1, &threshold2);
    }

}

void demo_hosal_pwm_stop(void)
{
    for (uint32_t i = 0; i < MAX_PWM_CHANNEL; i++)
    {
        bl_pwm_stop(i);
    }
}

void set_level(uint8_t currLevel)
{
    printf("%s\r\n",__func__);

}

void set_color_red(uint8_t currLevel)
{
    hard_set_color(currLevel, 0, 254);
}

void set_color_green(uint8_t currLevel)
{
    hard_set_color(currLevel, 84, 254);
}

void set_color_yellow(uint8_t currLevel)
{
    hard_set_color(currLevel, 42, 254);
}

static void hard_set_color(uint8_t currLevel, uint8_t currHue, uint8_t currSat)
{
#if MAX_PWM_CHANNEL
    uint16_t hue = (uint16_t) currHue * 360 / 254;
    uint8_t sat  = (uint16_t) currSat * 100 / 254;

    if (currLevel <= 5 && currLevel >= 1)
    {
        currLevel = 5; // avoid demo off
    }

    if (sat > 100)
    {
        sat = 100;
    }

    uint16_t i       = hue / 60;
    uint16_t rgb_max = currLevel;
    uint16_t rgb_min = rgb_max * (100 - sat) / 100;
    uint16_t diff    = hue % 60;
    uint16_t rgb_adj = (rgb_max - rgb_min) * diff / 60;
    uint32_t red, green, blue;

    switch (i)
    {
    case 0:
        red   = rgb_max;
        green = rgb_min + rgb_adj;
        blue  = rgb_min;
        break;
    case 1:
        red   = rgb_max - rgb_adj;
        green = rgb_max;
        blue  = rgb_min;
        break;
    case 2:
        red   = rgb_min;
        green = rgb_max;
        blue  = rgb_min + rgb_adj;
        break;
    case 3:
        red   = rgb_min;
        green = rgb_max - rgb_adj;
        blue  = rgb_max;
        break;
    case 4:
        red   = rgb_min + rgb_adj;
        green = rgb_min;
        blue  = rgb_max;
        break;
    default:
        red   = rgb_max;
        green = rgb_min;
        blue  = rgb_max - rgb_adj;
        break;
    }

    Rduty=(red*12);
    Gduty=(green*12);
    Bduty=(blue*12);
    printf("Rduty=%lx,Gduty=%lx,Bduty=%lx\r\n",Rduty,Gduty,Bduty);
    demo_hosal_pwm_set_param(Rduty,Gduty,Bduty,0,0);
#else
    set_level(currLevel);
#endif
}
void set_color(uint8_t currLevel, uint8_t currHue, uint8_t currSat)
{
    printf("%s\r\n",__func__);
    uint16_t hue = (uint16_t)currHue * 360 / 254;
    uint8_t  sat = (uint16_t)currSat * 100 / 254;

    if(sat > 100)
    {
        sat = 100;
    }

    uint16_t i       = hue / 60;
    uint16_t rgb_max = currLevel;
    uint16_t rgb_min = rgb_max * (100 - sat) / 100;
    uint16_t diff    = hue % 60;
    uint16_t rgb_adj = (rgb_max - rgb_min) * diff / 60;
    uint32_t red, green, blue;

    switch (i)
    {
    case 0:
        red   = rgb_max;
        green = rgb_min + rgb_adj;
        blue  = rgb_min;
        break;
    case 1:
        red   = rgb_max - rgb_adj;
        green = rgb_max;
        blue  = rgb_min;
        break;
    case 2:
        red   = rgb_min;
        green = rgb_max;
        blue  = rgb_min + rgb_adj;
        break;
    case 3:
        red   = rgb_min;
        green = rgb_max - rgb_adj;
        blue  = rgb_max;
        break;
    case 4:
        red   = rgb_min + rgb_adj;
        green = rgb_min;
        blue  = rgb_max;
        break;
    default:
        red   = rgb_max;
        green = rgb_min;
        blue  = rgb_max - rgb_adj;
        break;
    }

    new_Rduty=(red*12);
    new_Gduty=(green*12);
    new_Bduty=(blue*12);
    printf("now_Rduty update=%lx,now_Gduty update =%lx,now_Bduty update     =%lx\r\n",new_Rduty,new_Gduty,new_Bduty);
    if(Light_TimerHdl!=NULL)
    {
        if( xTimerIsTimerActive( Light_TimerHdl ) != pdFALSE )
        {
            if(Light_TimerHdl)
                xTimerStop(Light_TimerHdl, 0); 
        }
        if( xTimerChangePeriod(Light_TimerHdl, pdMS_TO_TICKS(1), 0 ) == pdPASS )
        {
                
            Light_Timer_Status=1;
            if(Light_TimerHdl)
                xTimerStart(Light_TimerHdl, 0); 
        }

    } 

  
}
void set_temperature(uint8_t currLevel,uint16_t temperature)
{
    static uint16_t targettemp;
    static uint8_t  targetlevel;
    if((targettemp!=temperature)||(targetlevel!=currLevel))
    {
        targettemp=temperature;
        targetlevel=currLevel;
        printf("%s\r\n",__func__);
        uint32_t hw_temp_delta=LAM_MAX_MIREDS_DEFAULT-LAM_MIN_MIREDS_DEFAULT;
        uint32_t soft_temp_delta;

        if(temperature>LAM_MAX_MIREDS_DEFAULT)
        {
            temperature=LAM_MAX_MIREDS_DEFAULT;
        }
        else if(temperature<LAM_MIN_MIREDS_DEFAULT)
        {
            temperature=LAM_MIN_MIREDS_DEFAULT;
        }

        soft_temp_delta=temperature-LAM_MIN_MIREDS_DEFAULT;
        soft_temp_delta*=100;

        uint32_t warm = (254*(soft_temp_delta/hw_temp_delta))/100;
        uint32_t clod  = 254-warm;
        new_Wduty=warm*12*currLevel/254;
        new_Cduty=clod*12*currLevel/254;
        printf("now_Cduty update=%lx,now_Wduty update =%lx\r\n",new_Cduty,new_Wduty);
        if(Light_TimerHdl!=NULL)
        {
            if( xTimerIsTimerActive( Light_TimerHdl ) != pdFALSE )
            {
                if(Light_TimerHdl)
                    xTimerStop(Light_TimerHdl, 0); 
            }
            if( xTimerChangePeriod(Light_TimerHdl, pdMS_TO_TICKS(1), 0 ) == pdPASS )
            {
                    
                Light_Timer_Status=2;
                if(Light_TimerHdl)
                    xTimerStart(Light_TimerHdl, 0); 
            }

        }
    }
    

    
    
}
void set_warm_temperature()
{
    uint16_t threshold1, threshold2;
    threshold1 = 0;
    Rduty=0;
    Gduty=0;
    Bduty=0;
    Wduty=254*12;
    Cduty=0;

    bl_pwm_set_duty(LED_R_PIN_PORT, pwm_curve[Rduty]);
    bl_pwm_set_duty(LED_G_PIN_PORT, pwm_curve[Gduty]);
    bl_pwm_set_duty(LED_B_PIN_PORT, pwm_curve[Bduty]);
    
    bl_pwm_set_duty_ex(LED_C_PIN_PORT, pwm_curve[Cduty],&threshold1, &threshold2);
    threshold1 = threshold2;
    bl_pwm_set_duty_ex(LED_W_PIN_PORT, pwm_curve[Wduty],&threshold1, &threshold2);
 
}

void set_cold_temperature(void)
{
    uint16_t threshold1, threshold2;
    threshold1 = 0;
    Rduty=0;
    Gduty=0;
    Bduty=0;
    Wduty=0;
    Cduty=254*12;

    bl_pwm_set_duty(LED_R_PIN_PORT, pwm_curve[Rduty]);
    bl_pwm_set_duty(LED_G_PIN_PORT, pwm_curve[Gduty]);
    bl_pwm_set_duty(LED_B_PIN_PORT, pwm_curve[Bduty]);
    
    bl_pwm_set_duty_ex(LED_C_PIN_PORT, pwm_curve[Cduty],&threshold1, &threshold2);
    threshold1 = threshold2;
    bl_pwm_set_duty_ex(LED_W_PIN_PORT, pwm_curve[Wduty],&threshold1, &threshold2);
}
void set_warm_cold_off(void)
{
    uint16_t threshold1, threshold2;
    threshold1 = 0;
    Rduty=0;
    Gduty=0;
    Bduty=0;
    Wduty=0;
    Cduty=0;

    bl_pwm_set_duty(LED_R_PIN_PORT, pwm_curve[Rduty]);
    bl_pwm_set_duty(LED_G_PIN_PORT, pwm_curve[Gduty]);
    bl_pwm_set_duty(LED_B_PIN_PORT, pwm_curve[Bduty]);
    
    bl_pwm_set_duty_ex(LED_C_PIN_PORT, pwm_curve[Cduty],&threshold1, &threshold2);
    threshold1 = threshold2;
    bl_pwm_set_duty_ex(LED_W_PIN_PORT, pwm_curve[Wduty],&threshold1, &threshold2);
}
static void Light_TimerHandler(TimerHandle_t p_timerhdl)
{

	if( Light_Timer_Status==1)
	{
		if((new_Rduty!=Rduty)||(new_Gduty!=Gduty)||(new_Bduty!=Bduty))
		{
			if(new_Rduty>Rduty)
			{
				Rduty++;
			}
			else if(new_Rduty<Rduty)
			{
				Rduty--;
			}


			if(new_Gduty>Gduty)
			{
				Gduty++;
			}
			else if(new_Gduty<Gduty)
			{
				Gduty--;
			}

			if(new_Bduty>Bduty)
			{
				Bduty++;
			}
			else if(new_Bduty<Bduty)
			{
				Bduty--;
			}
            demo_hosal_pwm_set_param(Rduty,Gduty,Bduty,0,0);
		}  
		else
		{
		    if(Light_TimerHdl)
            {
                xTimerStop(Light_TimerHdl, 0); 
            }
		    Light_Timer_Status=0;
		}
	}
	else if(Light_Timer_Status==2)
	{
		if((new_Cduty!=Cduty)||(new_Wduty!=Wduty))
		{
			if(new_Cduty>Cduty)
			{
				Cduty++;
			}
			else if(new_Cduty<Cduty)
			{
				Cduty--;
			}


			if(new_Wduty>Wduty)
			{
				Wduty++;
			}
			else if(new_Wduty<Wduty)
			{
				Wduty--;
			}
            demo_hosal_pwm_set_param(0,0,0,Cduty,Wduty);
		}
		else
		{
		    if(Light_TimerHdl)
            {
                xTimerStop(Light_TimerHdl, 0); 
            } 
		     Light_Timer_Status=0;
		}
           
            
	}

                   
}
static void demo_hosal_pwm_task_init(void)
{

    Light_TimerHdl = xTimerCreate("zb_Light_TimerHandler", pdMS_TO_TICKS(2), pdTRUE, NULL,  Light_TimerHandler);
}